{% load crispy_forms_tags %}
{% load i18n %}
{% load django_markdown %}

{% if request.user.is_authenticated %}
<script>
/* Dynamic top menu positioning */

var num = 0; //number of pixels before modifying styles

$(window).bind('scroll', function () {
    if ($(window).scrollTop() > num) {
        $('.invite_fd').addClass('invite_fx');
    } else {
        $('.invite_fd').removeClass('invite_fx');
    }
});
</script>

<script>
function getfocus() {
    document.getElementById("id_name").focus();
}
</script>
{% endif %}

{% for object in object_list %}
<div id="comment-{{object.id}}" class="comment">

    <div>
       {{object.text|markdown}}

    </div>

    <div class="actions">
        {% for transaction in object.paypal_transaction.all %}
        <div class="transaction" name="transaction-{{transaction.id}}"><b>+ {{transaction.amount}} {{transaction.currency}}</b> [{{transaction.sender_user}}] → [{{transaction.receiver_user}}] <b>via</b> PayPal [{{transaction.paymentExecStatus}}]
            </div>
        {% endfor %}

        {% for transaction in object.cryptsy_transaction.all %}
        <div class="transaction" name="transaction-{{transaction.id}}"><b>+ {{transaction.amount}} {{transaction.address.currency_code}}</b> [{{transaction.sender_credential.user}}] → [{{transaction.address.user}}] <b>via</b> Cryptsy [{{transaction.created_on}}]
        </div>
        {% endfor %}
        <div align="right">
        {% if object.hours_claimed or object.hours_assumed %}
        [<a href="{% url "payments:transaction_paypal" object.id %}"><i class="fa fa-paypal"></i> PayPal</a><!--,
        <a href="{% url "payments:transaction_cryptsy" object.id %}"><i class="fa fa-btc"></i> Cryptsy</a>-->]
        {% endif %}
        </div>
    </div>

    <div class="actions">
    <div class="alignright date">

        --[<a href="{% url "user-detail" object.user.username %}">{{object.user.username}}</a>], {{object.created_at}}<br/>
        <div align="right">
            {% if object.user == request.user %}[<a href="{% url "comment-update" object.id %}?next={{ request.path }}#comment-{{object.id }}">{% trans "edit" %}</a>, <a href="{% url "comment-delete" object.id %}?next={{ request.path }}">{% trans "delete" %}</a>]
            {% endif %}
        </div>
    </div>
    </div>

    <br>
    <hr>
</div>
{% endfor %}


{% if request.user.is_authenticated %}
<div class="panel panel-default input-comment">
<div class="panel-body">
{% crispy form %}
{% markdown_media %}
</div>
</div>

<div class="panel panel-default">
    <div class="panel-body">
        {% crispy conversation_form %}
    </div>
</div>
{% else %}
<a style="color:black;" href="{% url "account_login" %}?next={{ request.path }}#id_text"><button type="button">comment</button></a>
{% endif %}


{% if request.user.is_authenticated %}
<div class="invite_fd"><b><a href="#id_name" onclick="getfocus()" style="color:white; text-decoration: none;">{% trans "Invite a friend to help!" %}</a></b></div>
{% endif %}
