{% extends "base.html" %}
{% load i18n %}

{% load crispy_forms_tags %}
{% load django_markdown %}


{% block title %}w: {{ object.name }}{% endblock title %}

{% block content %}

<script>
function showMore(){
    document.getElementById("stats").innerHTML = "<span onmouseout='showLess()'>[<u>assumed</u> {{ object.total_assumed|floatformat:2 }} h, <u>donated</u> {{ object.total_donated|floatformat:2 }} ħ, <u>claimed</u> {{ object.total_claimed|floatformat:2 }}, <u>matched</u> {{ object.total_matched|floatformat:2}} ḥ]</span>";
}

function showLess(){
    document.getElementById("stats").innerHTML = "<span onmouseover='showMore()'><b>[<u>needs ${{ object.get_remain_usd|floatformat:2 }} for funding {{ object.not_funded_hours|floatformat:2}} hours</u>]</b></span>";
}
</script>

<div class="panel panel-default box col-sm-12 col-md-7">
<div class="panel-body">
    <div class="alignleft"><a href="#id_name" onclick="getfocus()"><i class="fa fa-share"></i></a></div>

      <div class="alignright">
          <form style="text-align: right;" action="/subscribe/" method="post" accept-charset="utf-8">{% csrf_token %}
                <input type="hidden" value="{{ content_type }}" id="id_content_type" name="content_type">
                <input type="hidden" value="{{ object_id }}" id="id_object_id" name="object_id">
                <p><input type="submit" value="{% if is_subscribed %}{% trans "Unsubscribe" %}{% else %}{% trans "Subscribe" %}{% endif %}"></p> 
          </form>
      </div>
      <div style="clear:both;"></div>

      <div align="right" id="stats">
        <span onmouseover="showMore()"><b>[<u>needs ${{ object.get_remain_usd|floatformat:2 }} for funding {{ object.not_funded_hours|floatformat:2}} hours</u>]</b></span>
      </div>
      attempt on task <a href="{% url "task-detail" object.task.pk %}">

		  {% if object.task.personal %}
		    {% if request.user in object.task.sharewith or request.user == object.task.user %}
		       {{ object.task }}
		    {% else %}
               {% trans "private" %} {% trans "task" %} (by {{ object.task.user.username }})
			{% endif %}
		  {% else %}
		  {{ object.task }}
		  {% endif %}
      
      </a></br>
      translations: 
      <!-- translations -->
    {% for translation in translations %}
    {% if translation.language.language_code %}
    <a href="{% url "work-detail" object.id %}?lang={{translation.language.language_code }}">
        [{{ translation.language.language_code }}]
    </a>
    {% endif %}
    {% endfor %}
    <a href="{{ translate_url }}">[+]</a>
    <!-- /translations -->

    <h1>{% if not translation %}{{ object.name }}{% else %}{{ translation.name}}{% endif %}</h1>

    <div>
        {% if object.is_historical %}
            <span class="badge" style="background-color: brown;">{% trans "historical" %}</span>
            <br />
        {% endif %}
        {% if object.is_link %}
        <i><span style="color:grey;">{% trans "Source:" %} <a href="{{ object.url }}" style="color:grey;">{{ object.url }}</a>.</span></i>
        {% endif %}
    </div>

    {% if object.user == request.user %}[<a href="{% if not translation %}{% url "work-update" object.pk %}{% else %}{% url "update-translation" translation.pk %}{% endif %}">edit</a>, <a href="{% if not translation %}{% url "work-delete" object.pk %}{% else %}{% url "delete-translation" translation.pk %}{% endif %}">delete</a>]<br/>{% endif %}
<br/>
{% if not translation %}
{{object.description|markdown}}
{% else %}
{{translation.description|markdown}}
{% endif %}
<div align="right">--[<a href="{% url 'user-detail' object.user.username %}">{{object.user}}</a>], {{object.created_at}}</div>

{% if object.personal %}<i class="fa {% if object.user == request.user %}fa-lock{% else %}fa-flag{% endif %}"></i> [<u>shared with:</u> {% for member in object.sharewith.all %} <a href="{% url 'user-detail' member.username %}">{{ member.username }}</a>{%if not forloop.last%}, {%endif%}{% endfor %}]{% endif %}

</div>
<br/>

<div class="panel-body">
<table class="table">
    <tr>
        <td>Url</td>
        <td>

        	{{object.url}}
        </td>
    </tr>
    <tr>
        <td>File</td>
        <td>

        	{{object.file}}
        </td>
    </tr>
</table>
</div>

<div class="panel-heading">Follow-up Works</div>
<div class="panel-body">
{% for object in work_list %}
    <ul class="list-group">
      <li class="list-group-item">

            {% if object.is_link %}
            <span class="badge">{% trans "link" %}</span>
            {% endif %}
            {% if object.personal %}
                {% if user.is_anonymous %}
                <i class="fa fa-lock"></i>
                {% else %}
                <i class="fa {% if object.user == request.user %}fa-lock{% else %}fa-flag{% endif %}"></i>
                {% endif %}
                {% if request.user in object.sharewith or request.user == object.user %}
                    <a href="{% url "work-detail" object.pk %}?lang={{ request.LANGUAGE_CODE }}">{{object.name}}</a>
                    <p>{{object.description|markdown|truncatewords_html:35}}</p>
                {% else %}
					<a href="{% url "work-detail" object.pk %}?lang={{ request.LANGUAGE_CODE }}">{% trans "Private" %} {% trans "work" %}.</a>
					<p>{% trans "Request access:" %} [<a href="{% url 'user-detail' object.user.username %}">{{object.user.username}}</a>]</p>
                {% endif %}
            {% else %}
                <a href="{% url "work-detail" object.pk %}?lang={{ request.LANGUAGE_CODE }}">{{object.name}}</a>
                <p>{{object.description|markdown|truncatewords_html:35}}</p>
            {% endif %}

      </li>
    </ul>
{% endfor %}
<a href="{% url "work-create" object.task.pk %}">+New Work</a>
</div>
</div>


{# Include comment list with transactions #}
{% include "comment/list.html" %}

{% endblock content %}
